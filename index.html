<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!-- Vega Lite -->
    <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

    <title>The Coffee Health</title>

    <style type="text/tailwindcss">
        @theme {
            --color-espresso: #362822;
            --color-coffee: #F0C376;
            --color-cream: #FAEDD6;

            --font-helvetica: "Helvetica Neue", Helvetica, sans-serif;
            --font-calibri: "Calibri", sans-serif;

            --text-display-base: 2rem;
            --text-display-sm: 2.75rem;
            --text-display-md: 4rem;
            --text-display-lg: 8rem;
            --text-body: 1rem;
            --text-small: 0.875rem;
        }

        html {
            scroll-behavior: smooth;
        }

        #sideNav {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        #sideNav .nav-item img {
            width: 25px;
            transition: transform 0.25s ease;
        }

        #sideNav .nav-item.active img {
            transform: scale(1.15);
        }

    /* --- Bean Container --- */
        .bean-row-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 80px; /* consistent gap */
            transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1); 
            will-change: transform;
        }

        /* --- Individual Beans --- */
        .bean-base {
            width: 40px; 
            cursor: pointer;
            opacity: 1;
            transform: scale(0.7); /* Start small */
            transition: transform 0.4s cubic-bezier(0.25, 1, 0.5, 1), 
                        opacity 0.4s ease, 
                        filter 0.4s ease;
            /* Prevent layout shift during scale */
            transform-origin: center center;
        }

        /* Active State (Center) */
        .bean-center {
            opacity: 1 !important;
            transform: scale(1.8) !important;
            z-index: 10;
        }

        /* --- Text Animation States --- */
        .testimony-anim {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .testimony-anim.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Decoration Line */
        .bean-line {
            width: 100%;
            max-width: 800px;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0,0,0), transparent);
            position: absolute;
            top: 28%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 0;
        }
    </style>

</head>

<body class="bg-white relative">
    <!-- SIDE NAV -->
    <aside class="fixed right-15 top-1/2 -translate-y-1/2 space-y-6 z-50 hidden md:flex flex-col items-center">
        <nav id="sideNav">
            <a href="#sec1" class="nav-item" data-section="sec1">
                <img src="src\bean-default.svg" 
                    data-default="src\bean-default.svg" 
                    data-active="src\bean-clicked.svg" />
            </a>
            <a href="#sec2" class="nav-item" data-section="sec2">
                <img src="src\bean-default.svg" 
                    data-default="src\bean-default.svg" 
                    data-active="src\bean-clicked.svg" />
            </a>
            <a href="#sec3" class="nav-item" data-section="sec3">
                <img src="src\bean-default.svg" 
                    data-default="src\bean-default.svg" 
                    data-active="src\bean-clicked.svg" />
            </a>
            <a href="#sec4" class="nav-item" data-section="sec4">
                <img src="src\bean-default.svg" 
                    data-default="src\bean-default.svg" 
                    data-active="src\bean-clicked.svg" />
            </a>
            <a href="#sec5" class="nav-item" data-section="sec5">
                <img src="src\bean-default.svg" 
                    data-default="src\bean-default.svg" 
                    data-active="src\bean-clicked.svg" />
            </a>
            <a href="#sec6" class="nav-item" data-section="sec6">
                <img src="src\bean-default.svg" 
                    data-default="src\bean-default.svg" 
                    data-active="src\bean-clicked.svg" />
            </a> 
            <a href="#sec7" class="nav-item" data-section="sec7">
                <img src="src\bean-default.svg" 
                    data-default="src\bean-default.svg" 
                    data-active="src\bean-clicked.svg" />
            </a>     
            <a href="#sec8" class="nav-item" data-section="sec8">
                <img src="src\bean-default.svg" 
                    data-default="src\bean-default.svg" 
                    data-active="src\bean-clicked.svg" />
            </a>                                            
        </nav>
    </aside>

    <!-- HERO -->
    <section id="sec1"
        class="relative min-h-screen flex flex-col justify-center items-center overflow-hidden">

        <!-- Top Left -->
        <img src="src/index-topLeft.svg"
            class="
                absolute
                top-[40px] left-[40px] w-[110px]
                sm:top-[50px] sm:left-[60px] sm:w-[130px]
                md:top-[60px] md:left-[40px] md:w-[140px]
                lg:top-[70px] lg:left-[80px] lg:w-[200px]
                xl:top-[80px] xl:left-[160px] xl:w-[230px]
            " />

        <!-- Top Right -->
        <img src="src/index-topRight.svg"
            class="
                absolute
                top-[20px] right-[40px] w-[110px]
                sm:top-[35px] sm:right-[60px] sm:w-[130px]
                md:top-[45px] md:right-[100px] md:w-[160px]
                lg:top-[50px] lg:right-[80px] lg:w-[200px]
                xl:top-[60px] xl:right-[160px] xl:w-[230px]
            " />

        <p class="font-calibri text-body text-espresso mt-6 text-center max-w-2xl">
            A Visualization Narrative By Caffeine Mugs
        </p>

        <h1 class="font-helvetica font-thin text-display-sm md:text-display-md text-espresso text-center mb-4">
            The Coffee Health
        </h1>

        <!-- Cup -->
        <div class="relative w-full max-w-[400px] sm:max-w-[440px] md:max-w-[500px] lg:max-w-[580px] xl:max-w-[650px] mx-auto">
            <img src="src/index-cup.svg" class="relative w-full z-10" />
        </div>

        <!-- Bottom Left -->
        <img src="src/index-bottomLeft.svg"
            class="
                absolute
                bottom-[50px] left-[40px] w-[100px]
                sm:bottom-[60px] sm:left-[60px] sm:w-[120px]
                md:bottom-[70px] md:left-[95px] md:w-[150px]
                lg:bottom-[80px] lg:left-[130px] lg:w-[170px]
                xl:bottom-[95px] xl:left-[160px] xl:w-[190px]
            " />

        <!-- Bottom Right -->
        <img src="src/index-bottomRight.svg"
            class="
                absolute
                bottom-[45px] right-[40px] w-[100px]
                sm:bottom-[55px] sm:right-[60px] sm:w-[120px]
                md:bottom-[65px] md:right-[95px] md:w-[150px]
                lg:bottom-[75px] lg:right-[130px] lg:w-[170px]
                xl:bottom-[90px] xl:right-[160px] xl:w-[190px]
            " />
    </section>

    <!-- WHY DRINK COFFEE -->
    <section id="sec2" class="mt-60 mb-60">
        <div class="relative grid grid-cols-1 lg:grid-cols-2 gap-10 justify-stretch items-start px-6 md:px-14 lg:px-24 py-20">
            <img 
                src="src/page1-bean.svg" 
                class="
                    absolute
                    top-[40px] left-[40px] w-[110px]
                    sm:left-[60px] sm:w-[130px]
                    md:left-[140px] md:w-[140px]
                    lg:left-[360px] lg:w-[200px]
                    xl:left-[400px] xl:w-[230px]
                "
            />

            <!-- Text -->
            <div>
                <h2 class="font-helvetica mt-30 text-display-sm md:text-display-md md:mt-[10] mb-6 leading-tight">
                    Why Do We Drink Coffee?
                </h2>

                <p class="font-calibri text-body text-espresso leading-relaxed">
                    Ever wonder why do so many of us reach for coffee every day? We highlight the top reasons 
                    people drink coffee and the results might feel familiar. Most people drink it because they 
                    genuinely enjoy the taste, while others rely on that boost of energy to get through the day.
                </p>
            </div>

            <!-- Illustration -->
            <div class="flex justify-center lg:justify-center order-first lg:order-none">
                <img src="src/page1-cup.svg" class="w-56 md:w-72 lg:w-[26rem]" />
            </div>
        </div>

        <!-- Chart -->
        <div class="lg:col-span-2 mt-10 flex flex-col items-center">
            <div id="chart_coffee_reasons" class="w-full max-w-4xl mx-auto"></div>

            <div class="mt-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                <p class="font-calibri text-small md:text-body text-espresso">
                    Data source:
                    <a href="https://www.statista.com/statistics/1450363/reasons-for-drinking-coffee-in-the-us/"
                        target="_blank" rel="noopener noreferrer" class="underline hover:text-coffee">
                        Statista – Reasons for drinking coffee in the U.S.
                    </a>
                </p>
            </div>
        </div>
    </section>


    <!-- SLEEP HOURS -->
    <section id="sec3" class="mb-60">
        <div class="relative grid grid-cols-1 lg:grid-cols-2 gap-10 justify-stretch items-start px-6 md:px-14 lg:px-24 py-20">
            <img 
                src="src/page2-bean.svg" 
                class="
                    absolute
                    top-[40px] left-[40px] w-[110px]
                    sm:top-[50px] sm:left-[60px] sm:w-[130px]
                    md:top-[60px] md:left-[40px] md:w-[140px]
                    lg:top-[-10px] lg:left-[120px] lg:w-[200px]
                    xl:top-[-20px] xl:left-[150px] xl:w-[230px]
                "
            />

            <!-- Text -->
            <div>
                <h2 class="font-helvetica mt-30 font-thin text-display-sm md:text-display-md text-espresso mb-6 leading-tight">
                    Caffeine vs Sleep Hours
                </h2>
                <p class="font-calibri text-body text-espresso leading-relaxed">
                    Now we dive into how sleep and caffeine interact for different people. 
                    In the plotted graph comparing men and women, we reveal a surprising trend: individuals who get more 
                    sleep actually tend to drink more caffeine.        
                </p>
            </div>

            <!-- Illustration -->
            <div class="flex justify-center lg:justify-center order-first lg:order-none">
                <img src="src\page2-img.svg" class="w-56 md:w-72 lg:w-[26rem]" />
            </div>
        </div>

        <!-- Chart -->
        <div class="lg:col-span-2 mt-10 flex flex-col items-center">
            <div id="sleepHours" class="w-full mt-12 max-w-5xl mx-auto"></div>
        </div>
    </section>


    <!-- SLEEP QUALITY -->
    <section id="sec4" class="mb-60">
        <div class="relative mt-30 grid grid-cols-1 lg:grid-cols-2 gap-10 justify-center items-center px-6 md:px-14 lg:px-24 py-20">
            <img 
                src="src/page3-bean.svg" 
                class="
                    absolute
                    top-[40px] right-[40px] w-[110px]
                    sm:top-[50px] sm:right-[60px] sm:w-[130px]
                    md:top-[60px] md:right-[40px] md:w-[140px]
                    lg:top-[-60px] lg:right-[80px] lg:w-[200px]
                    xl:top-[-70px] xl:right-[100px] xl:w-[230px]
                "
            />
            <!-- Illustration -->
            <div class="flex justify-start lg:justify-start order-first lg:order-none">
                <img src="src\page3-img.svg" class="w-66 md:w-82 lg:w-[28rem]" />
            </div>

            <!-- Text -->
            <div>
                <h2 class="font-helvetica font-thin text-display-sm md:text-display-md text-espresso mb-6 leading-tight">
                    Caffeine vs Sleep Quality
                </h2>

                <p class="font-calibri text-body text-espresso leading-relaxed">
                    In a stacked bar graph below paints a fuller picture of how caffeine intake relates not just to hours of 
                    sleep but to the quality of that sleep. From “poor” to “excellent,” each level of sleep quality is displayed 
                    alongside different levels of caffeine consumption.        
                </p>
            </div>
        </div>

        <!-- Chart -->
        <section class="mt-6 flex flex-col md:items-center md:justify-between gap-4">
            <!-- Section: Scatter plot -->
            <section class="mt-16">

                <h2 class="font-helvetica font-semibold text-link-sm md:text-link-md text-espresso mb-4">
                    Individual Caffeine Intake and Corresponding Sleep Quality
                </h2>

                <div id="sleepQualityScatter" class="w-full"></div>

                <!-- Description row -->
                <div class="flex items-center gap-3 mt-4">
                    <img src="src\bean-clicked.svg" alt="Average caffeine marker" class="w-5 h-5" />

                    <p class="font-calibri text-small md:text-body text-espresso">
                        This coffee bean marks the average caffeine intake for each sleep quality group. Hover over the bean
                        to view the average intake.
                    </p>
                </div>
            </section>

            <!-- Section: Proportion chart -->
            <section class="mt-16">
                <h2 class="font-helvetica font-semibold text-link-sm md:text-link-md text-espresso mb-4">
                    Proportion of Sleep Quality Levels by Caffeine Intake
                </h2>

                <div id="sleepQuality" class="w-full mt-4"></div>
            </section>
        </section>
    </section>

    <!-- ACTIVITY & AGE -->
    <section id="sec5" class="mb-60">
        <div class="relative mt-30 grid grid-cols-1 lg:grid-cols-2 gap-10 justify-center items-center px-6 md:px-14 lg:px-24 py-20">

            <img 
                src="src/page4-bean.svg" 
                class="
                    absolute
                    top-[40px] right-[40px] w-[110px]
                    sm:top-[50px] sm:right-[60px] sm:w-[130px]
                    md:top-[60px] md:right-[40px] md:w-[140px]
                    lg:top-[-60px] lg:right-[80px] lg:w-[200px]
                    xl:top-[-70px] xl:right-[100px] xl:w-[230px]
                "
            />
            <!-- Illustration -->
            <div class="flex justify-start lg:justify-start order-first lg:order-none">
                <img src="src\page4-img.svg" class="w-66 md:w-82 lg:w-[28rem]" />
            </div>

            <!-- Text -->
            <div>
                <h2 class="font-helvetica font-thin text-display-sm md:text-display-md text-espresso mb-6 leading-tight">
                    Coffee, Activity & Age
                </h2>

                <p class="font-calibri text-body text-espresso leading-relaxed">
                    In a stacked bar graph below paints a fuller picture of how caffeine intake relates not just to hours of 
                    sleep but to the quality of that sleep. From “poor” to “excellent,” each level of sleep quality is displayed 
                    alongside different levels of caffeine consumption.        
                </p>
            </div>

        <!-- Chart -->
        <div class="lg:col-span-2 mt-10 flex flex-col items-center">
            <div id="coffeeActivityByAgeSummary" class="mt-16 max-w-5xl mx-auto"></div>
        </div>
    </section>


    <!-- STRESS -->
    <section id="sec6" class="mb-60">
        <div class="relative mt-30 grid grid-cols-1 lg:grid-cols-2 gap-10 justify-center items-center px-6 md:px-14 lg:px-24 py-20">
            <img 
                src="src/page5-bean.svg" 
                class="
                    absolute
                    top-[40px] right-[40px] w-[110px]
                    sm:top-[50px] sm:right-[60px] sm:w-[130px]
                    md:top-[60px] md:right-[40px] md:w-[140px]
                    lg:top-[-60px] lg:right-[80px] lg:w-[200px]
                    xl:top-[-70px] xl:right-[100px] xl:w-[230px]
                "
            />
            <!-- Illustration -->
            <div class="flex justify-start lg:justify-start order-first lg:order-none">
                <img src="src\page5-img.svg" class="w-66 md:w-82 lg:w-[28rem]" />
            </div>

            <!-- Text -->
            <div>
                <h2 class="font-helvetica font-thin text-display-sm md:text-display-md text-espresso mb-6 leading-tight">
                    Caffeine & Stress
                </h2>

                <p class="font-calibri text-body text-espresso leading-relaxed">
                    Now we dive into how sleep and caffeine interact for different people. 
                    In the plotted graph comparing men and women, we reveal a surprising trend: individuals who get more 
                    sleep actually tend to drink more caffeine.        
                </p>
            </div>
        </div>

        <!-- Chart -->
        <div class="lg:col-span-2 mt-10 flex flex-col items-center">
            <div id="stressCoffee" class="w-full mt-12 max-w-5xl mx-auto"></div>
        </div>
    </section>


    <!-- A DAY -->
    <section id="sec7" class="mb-30">
        <div class="relative mt-30 grid grid-cols-1 lg:grid-cols-2 gap-10 justify-center items-center px-6 md:px-14 lg:px-24 py-20">
            <!-- Illustration -->
            <div class="flex justify-start lg:justify-start order-first lg:order-none">
                <img src="src/page6-img.svg" class="w-66 md:w-82 lg:w-[28rem]" />
            </div>

            <!-- Text -->
            <div>
                <h2 class="font-helvetica font-thin text-display-sm md:text-display-md text-espresso mb-6 leading-tight">
                    A Day In The Life Of A Coffee Lover
                </h2>

                <p class="font-calibri text-body text-espresso leading-relaxed">
                    Here we will walk you through the story of caffeine; a fatigue cycle many of us fall into without realizing it. 
                    In this interactive timeline, we illustrate what happens throughout a person’s day, collecting data from our friends and 
                    family: how many hours of sleep a person gets, to their sleep quality and their regular, daily caffeine consumption.       
                </p>
            </div>
        </div>

        <!-- Chart -->
        <section class="w-full mt-12 max-w-5xl mx-auto">
            <div class="flex flex-col md:flex-row justify-center items-center gap-10">
                <div id="ageChart" class="w-full md:w-1/2"></div>
                <div id="genderChart" class="w-full md:w-1/2"></div>
            </div>
            <div class=" mt-10 flex flex-col items-center">
                <div class="mt-12" id="genderCoffeeChart"></div>
                <div class="mt-12" id="weekdayActivityChart"></div>
                <div class="mt-12" id="coffeeSleepMeanChart"></div>
            </div>
        </section>

        <!-- Testimony carousel -->
        <!-- Text -->
        <div class="relative mt-8 grid grid-cols-1 justify-center items-center px-6 md:px-24 lg:px-44 py-20">
            <h3 class="font-helvetica font-thin text-display-base md:text-display-base text-espresso mb-6 leading-tight">
                Our Participants’ Comments On Caffeine & Their Health
            </h3>

            <p class="font-calibri text-body text-espresso leading-relaxed">
                We asked participants to comment on their sleep schedule or sleep quality and if they feel drinking coffee 
                has negatively impacted their health. We recorded the most interesting insights. Click on a coffee bean below to read about what participants say.      
            </p>
        </div>
        <div id="testimonialSection" class="relative flex flex-col items-center mt-8 w-full max-w-5xl mx-auto overflow-hidden py-10">
            <div class="bean-line"></div>

            <div class="relative w-full flex justify-center h-24">
                <div id="beanRow" class="bean-row-container"></div>
            </div>

            <div class="text-center max-w-2xl px-8 mt-6 min-h-[120px]">
                <p id="testimonyText" class="testimony-anim italic text-espresso text-xl font-serif leading-relaxed">
                    Loading testimony...
                </p>

                <p id="testimonyInfo" class="testimony-anim mt-3 text-sm text-gray-500 font-sans tracking-wide">
                    ...
                </p>
            </div>
        </div>

        <!-- markers -->
        <div id="testimonialMarkers" class="flex gap-2 mt-4"></div>

        <div class="relative mt-5 grid grid-cols-1 lg:grid-cols-2 gap-10 justify-center items-center px-6 md:px-14 lg:px-24 py-20">
            <img 
                src="src/page6-bean.svg" 
                class="
                    absolute
                    top-[40px] right-[40px] w-[110px]
                    sm:top-[50px] sm:right-[60px] sm:w-[130px]
                    md:top-[60px] md:right-[40px] md:w-[140px]
                    lg:top-[-40px] lg:right-[80px] lg:w-[200px]
                    xl:top-[-50px] xl:right-[100px] xl:w-[230px]
                "
            />
        </div>
    </section>


    <!-- REFLECT ON YOUR HEALTH -->
    <section id="sec8" class="min-h-screen px-6 md:px-14 lg:px-24 py-24">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10 items-center">

            <!-- Illustration -->
            <div class="lg:col-span-5 flex justify-center lg:justify-start">
                <img src="src/page7-img.svg" class="w-64 md:w-72 lg:w-[26rem]" />
            </div>

            <!-- Text -->
            <div class="lg:col-span-7">
                <h2 class="font-helvetica font-thin text-display-sm md:text-display-md text-espresso">
                    Reflect On Your Health
                </h2>

                <p class="font-calibri text-body text-espresso mt-6 max-w-xl leading-relaxed">
                    Now it’s time to reflect on what you have learned about caffeine and your health. Play 
                    around in the visualization dashboard and enter how many cups of coffee and sleep hours you consume daily. 
                    You may be surprised to see how your health may be affected by caffeine, or not!
                </p>
            </div>
        </div>

        <!-- Input + Result dashboard -->
        <section class="w-full mt-16 max-w-6xl mx-auto">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">

                <!-- Left: Input card -->
                <div class="rounded-3xl border border-[#E5D2B5] bg-[#FFF9EF] p-8 shadow-sm">
                    <h2 class="font-helvetica font-semibold text-link-sm md:text-link-md text-espresso mb-4">
                        Enter your daily habits
                    </h2>

                    <form id="healthForm" class="space-y-6" onsubmit="event.preventDefault(); analyzeHealth();">
                        <!-- Gender -->
                        <div>
                            <label for="genderInput" class="block text-small font-helvetica text-espresso mb-2">
                                Gender
                            </label>
                            <select id="genderInput"
                                class="w-full border border-gray-300 rounded-xl px-4 py-2 text-small font-helvetica focus:outline-none focus:ring-2 focus:ring-[#E9C98F]">
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>

                        <!-- Age -->
                        <div>
                            <label for="ageInput" class="block text-small font-helvetica text-espresso mb-2">
                                Age
                            </label>
                            <input id="ageInput" type="number" min="15" max="90" step="1" placeholder="For example 26"
                                class="w-full border border-gray-300 rounded-xl px-4 py-2 text-small font-helvetica focus:outline-none focus:ring-2 focus:ring-[#E9C98F]">
                        </div>

                        <!-- Coffee intake -->
                        <div>
                            <label for="coffeeInput" class="block text-small font-helvetica text-espresso mb-2">
                                Cups of coffee per day
                            </label>
                            <input id="coffeeInput" type="number" min="0" max="15" step="0.1"
                                placeholder="For example 2.5"
                                class="w-full border border-gray-300 rounded-xl px-4 py-2 text-small font-helvetica focus:outline-none focus:ring-2 focus:ring-[#E9C98F]">
                        </div>

                        <!-- Sleep hours -->
                        <div>
                            <label for="sleepInput" class="block text-small font-helvetica text-espresso mb-2">
                                Sleep hours per night
                            </label>
                            <input id="sleepInput" type="number" min="0" max="14" step="0.1"
                                placeholder="For example 7.0"
                                class="w-full border border-gray-300 rounded-xl px-4 py-2 text-small font-helvetica focus:outline-none focus:ring-2 focus:ring-[#E9C98F]">
                        </div>

                        <!-- Stress level -->
                        <div>
                            <label for="stressInput" class="block text-small font-helvetica text-espresso mb-2">
                                Stress level (1–10, self rated)
                            </label>
                            <input id="stressInput" type="number" min="1" max="10" step="1" placeholder="For example 7"
                                class="w-full border border-gray-300 rounded-xl px-4 py-2 text-small font-helvetica focus:outline-none focus:ring-2 focus:ring-[#E9C98F]">
                        </div>

                        <button type="submit"
                            class="mt-4 inline-flex items-center justify-center rounded-[25px] px-8 py-3 bg-[#1E2E3E] text-white text-button font-helvetica transition-all duration-300 hover:shadow-[-6px_6px_0_#E9C98F] active:bg-[#E9C98F] active:text-[#362822] active:border active:border-[#4A2B18] active:shadow-none active:scale-95">
                            Reflect with the dataset
                        </button>
                    </form>
                </div>

                <!-- Right: Result card -->
                <div id="resultCard"
                    class="rounded-3xl border border-[#E5D2B5] bg-white p-8 shadow-sm flex flex-col justify-between">
                    <div>
                        <h2 class="font-helvetica font-semibold text-link-sm md:text-link-md text-espresso mb-4">
                            Your Health Predictor
                        </h2>

                        <p id="loadingMessage" class="text-small md:text-body font-helvetica text-gray-500 mb-6">
                            Enter your information on the left and see how you compare to our research.
                        </p>

                        <div id="vizContainer" class="space-y-8 hidden">
                            <!-- Legend -->
                            <div class="flex items-center space-x-6 mb-6">
                                <div class="flex items-center space-x-3">
                                    <img src="src\bean-clicked.svg" alt="You legend" class="h-5 w-auto">
                                    <span class="text-small font-helvetica text-espresso">You</span>
                                </div>

                                <div class="flex items-center space-x-3">
                                    <img src="src\bean-default.svg" alt="Average legend" class="h-5 w-auto">
                                    <span class="text-small font-helvetica text-espresso">Group average</span>
                                </div>
                            </div>

                            <p id="summaryText"
                                class="text-small md:text-body font-helvetica text-espresso leading-relaxed"></p>

                            <!-- Coffee bar -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-baseline">
                                    <span class="text-small font-helvetica text-espresso">
                                        Daily coffee intake
                                    </span>
                                    <span id="coffeeLabel" class="text-xs font-helvetica text-gray-500"></span>
                                </div>

                                <!-- Outer wrapper controlling bar + beans -->
                                <div class="relative h-10">
                                    <!-- Bar background -->
                                    <div
                                        class="absolute inset-x-0 bottom-0 h-4 rounded-full bg-[#F2E2C8] overflow-hidden">
                                    </div>

                                    <!-- User position bean -->
                                    <div id="coffeeYouWrap" class="absolute flex flex-col items-center z-10"
                                        style="top:-2px; left:50%; transform:translateX(-50%);">
                                        <span class="text-[10px] font-helvetica text-[#1E2E3E] mb-1">You</span>
                                        <img id="coffeeYou" src="src\bean-clicked.svg" alt="You indicator"
                                            class="h-5 w-auto">
                                    </div>

                                    <!-- Average position bean -->
                                    <div id="coffeeAvgWrap" class="absolute flex flex-col items-center z-10"
                                        style="top:-2px; left:60%; transform:translateX(-50%);">
                                        <span class="text-[10px] font-helvetica text-[#362822] mb-1">Avg</span>
                                        <img id="coffeeAvg" src="src\bean-default.svg" alt="Average indicator"
                                            class="h-5 w-auto">
                                    </div>
                                </div>

                                <div class="flex justify-between text-[11px] font-helvetica text-gray-500">
                                    <span>Lower intake</span>
                                    <span>Higher intake</span>
                                </div>
                            </div>

                            <!-- Sleep bar -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-baseline">
                                    <span class="text-small font-helvetica text-espresso">
                                        Sleep hours per night
                                    </span>
                                    <span id="sleepLabel" class="text-xs font-helvetica text-gray-500"></span>
                                </div>

                                <!-- Outer wrapper -->
                                <div class="relative h-10">
                                    <!-- Bar background -->
                                    <div
                                        class="absolute inset-x-0 bottom-0 h-4 rounded-full bg-[#F2E2C8] overflow-hidden">
                                    </div>

                                    <!-- User position bean -->
                                    <div id="sleepYouWrap" class="absolute flex flex-col items-center z-10"
                                        style="top:-2px; left:50%; transform:translateX(-50%);">
                                        <span class="text-[10px] font-helvetica text-[#1E2E3E] mb-1">You</span>
                                        <img id="sleepYou" src="src\bean-clicked.svg" alt="You indicator"
                                            class="h-5 w-auto">
                                    </div>

                                    <!-- Average position bean -->
                                    <div id="sleepAvgWrap" class="absolute flex flex-col items-center z-10"
                                        style="top:-2px; left:60%; transform:translateX(-50%);">
                                        <span class="text-[10px] font-helvetica text-[#362822] mb-1">Avg</span>
                                        <img id="sleepAvg" src="src\bean-default.svg" alt="Average indicator"
                                            class="h-5 w-auto">
                                    </div>
                                </div>

                                <div class="flex justify-between text-[11px] font-helvetica text-gray-500">
                                    <span>Less sleep</span>
                                    <span>More sleep</span>
                                </div>
                            </div>

                            <!-- Stress bar -->
                            <div class="space-y-2">
                                <div class="flex justify-between items-baseline">
                                    <span class="text-small font-helvetica text-espresso">
                                        Stress level (self rated)
                                    </span>
                                    <span id="stressLabel" class="text-xs font-helvetica text-gray-500"></span>
                                </div>

                                <!-- Wrapper for bar + bean -->
                                <div class="relative h-10">
                                    <!-- Bar background with segments -->
                                    <div
                                        class="absolute inset-x-0 bottom-0 h-4 rounded-full bg-[#F2E2C8] overflow-hidden">
                                        <div class="absolute inset-y-0 left-0 w-1/3 border-r border-white/60"></div>
                                        <div class="absolute inset-y-0 left-1/3 w-1/3 border-r border-white/60"></div>
                                    </div>

                                    <!-- Bean indicator -->
                                    <div id="stressYouWrap" class="absolute flex flex-col items-center z-10"
                                        style="top:-2px; left:50%; transform:translateX(-50%);">
                                        <span class="text-[10px] font-helvetica text-[#1E2E3E] mb-1">You</span>
                                        <img id="stressYou" src="src\bean-clicked.svg" alt="You indicator"
                                            class="h-5 w-auto">
                                    </div>
                                </div>

                                <div class="flex justify-between text-[11px] font-helvetica text-gray-500">
                                    <span>Low</span>
                                    <span>Medium</span>
                                    <span>High</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <p class="mt-6 text-[11px] md:text-xs font-helvetica text-gray-500">
                        Disclaimer: This dashboard is for personal reflection only. It is based on patterns from
                        Caffeine Mugs’ caffeine and health datasets and research, and does not provide medical advice.
                    </p>
                </div>

            </div>
        </section>

        <!-- Final Insights -->
        <div class="mt-24">
            <h2 class="font-helvetica font-thin text-display-sm md:text-display-md text-espresso">
                Final Insights
            </h2>

            <p class="font-calibri text-body text-espresso mt-6 leading-relaxed">
                Our visualizations show that caffeine intake relates to several aspects of daily life, including sleep duration, sleep quality, 
                physical activity, and stress levels. We also notice clear differences in coffee habits across age groups and genders. These patterns reveal a 
                variety in how people use caffeine and how their bodies respond to it.<br><br>
            
                The trends we discovered offer interesting insights and help us understand why people drink 
                coffee and how it may influence their well-being. With more data in the future, such as occupation, 
                region, or lifestyle factors, we could explore even richer relationships and uncover new perspectives<br><br>
            
                It is important to recognize that the impact of caffeine does not follow a single rule. Each person has 
                a unique physical condition, sensitivity, and tolerance level. The charts in this project should be viewed as 
                observations rather than health guidance. In reality, the most reliable approach is to pay attention to your own 
                body, notice how your energy, sleep, and stress levels change, and adjust your habits based on what works for you.<br><br>

                We hope these visualizations encourage you to reflect on your routines, make choices that support your learning and 
                daily life, and explore the activities that help you relax and recharge in a way that feels right for you.
            </p>
        </div>
    </section>

    <!-- Script -->
    <script src="main.js"></script>
    <!-- Tooltip (used by JS) -->
    <div id="tooltip"
        class="absolute px-2 py-1 text-xs font-helvetica bg-[#362822] text-white rounded hidden pointer-events-none"
        style="z-index:999; transform:translate(-50%, -120%);">
    </div>

    <!-- Page-specific JS -->
    <script>
        let caffeineData = [];
        let dataLoaded = false;

        // Read caffeine.csv
        fetch("caffeine.csv")
            .then(response => response.text())
            .then(text => {
                const lines = text.trim().split("\n");
                const headers = lines[0].split(",");
                caffeineData = lines.slice(1).map(line => {
                    const values = line.split(",");
                    const row = {};
                    headers.forEach((h, i) => {
                        const key = h.trim();
                        const value = values[i] ? values[i].trim() : "";
                        const num = Number(value);
                        row[key] = isNaN(num) ? value : num;
                    });
                    return row;
                });

                dataLoaded = true;
                document.getElementById("loadingMessage").innerText =
                    "Enter your information on the left and see how you compare to our research.";
            })
            .catch(err => {
                console.error(err);
                document.getElementById("loadingMessage").innerText =
                    "Could not load the dataset. Please check the file path.";
            });

        // Percentile helper
        function getPercentile(values, x) {
            const filtered = values.filter(v => typeof v === "number" && !isNaN(v));
            if (!filtered.length) return null;
            filtered.sort((a, b) => a - b);
            const count = filtered.filter(v => v <= x).length;
            return Math.round((count / filtered.length) * 100);
        }

        // Map numeric value to 0–100% left position
        function getPosition(values, x) {
            const filtered = values.filter(v => typeof v === "number" && !isNaN(v));
            if (!filtered.length) return 50;
            const min = Math.min(...filtered);
            const max = Math.max(...filtered);
            if (max === min) return 50;
            const t = (x - min) / (max - min);
            return Math.max(0, Math.min(100, t * 100));
        }

        // Map dataset stress levels (Low/Medium/High) to numeric scores
        function levelToScore(level) {
            if (level === "Low") return 3;
            if (level === "Medium") return 6;
            if (level === "High") return 9;
            return 6;
        }

        // Map a 1–10 stress score to a 0–100 position
        function stressScoreToPos(score) {
            if (isNaN(score)) return 50;
            const t = (score - 1) / 9;
            return Math.max(0, Math.min(100, t * 100));
        }

        // Tooltip base
        const tooltip = document.getElementById("tooltip");

        function attachTooltip(targetId, text) {
            const target = document.getElementById(targetId);
            if (!target) return;
            const wrapper = target.parentElement;
            if (!wrapper) return;

            // Store text for later updates
            wrapper.dataset.tooltipText = text;

            // Avoid binding multiple listeners
            if (wrapper.dataset.tooltipAttached === "true") {
                return;
            }
            wrapper.dataset.tooltipAttached = "true";

            wrapper.addEventListener("mouseenter", () => {
                tooltip.innerText = wrapper.dataset.tooltipText || "";
                tooltip.classList.remove("hidden");
            });

            wrapper.addEventListener("mouseleave", () => {
                tooltip.classList.add("hidden");
            });

            wrapper.addEventListener("mousemove", (e) => {
                tooltip.style.left = e.pageX + "px";
                tooltip.style.top = e.pageY + "px";
                tooltip.innerText = wrapper.dataset.tooltipText || "";
            });
        }

        function analyzeHealth() {
            if (!dataLoaded) {
                alert("Dataset is still loading. Please try again in a moment.");
                return;
            }

            const gender = document.getElementById("genderInput").value;
            const age = Number(document.getElementById("ageInput").value);
            const cups = Number(document.getElementById("coffeeInput").value);
            const sleep = Number(document.getElementById("sleepInput").value);
            const stressScore = Number(document.getElementById("stressInput").value);

            if (!age || isNaN(cups) || isNaN(sleep) || isNaN(stressScore)) {
                alert("Please fill in age, coffee intake, sleep hours, and stress level.");
                return;
            }

            // Base group: full dataset or same-gender subset
            let group = caffeineData;
            if (gender) {
                const filtered = caffeineData.filter(d => d.Gender === gender);
                if (filtered.length > 30) {
                    group = filtered;
                }
            }

            const intakeValues = group.map(d => d.Coffee_Intake);
            const sleepValues = group.map(d => d.Sleep_Hours);

            const coffeePct = getPercentile(intakeValues, cups);
            const sleepPct = getPercentile(sleepValues, sleep);

            const avgCoffee = intakeValues.reduce((a, b) => a + b, 0) / intakeValues.length;
            const avgSleep = sleepValues.reduce((a, b) => a + b, 0) / sleepValues.length;

            // Summary text
            const summaryParts = [];
            summaryParts.push(
                `You are ${age} years old and reported ${cups.toFixed(1)} cups of coffee per day with ${sleep.toFixed(1)} hours of sleep.`
            );
            if (gender) {
                summaryParts.push(
                    `The visualisation uses people of the same gender when there are enough records, otherwise it uses the full dataset.`
                );
            } else {
                summaryParts.push(`The visualisation uses the full dataset.`);
            }
            document.getElementById("summaryText").innerText = summaryParts.join(" ");

            // Coffee position + label
            const coffeePosYou = getPosition(intakeValues, cups);
            const coffeePosAvg = getPosition(intakeValues, avgCoffee);
            document.getElementById("coffeeYouWrap").style.left = coffeePosYou + "%";
            document.getElementById("coffeeAvgWrap").style.left = coffeePosAvg + "%";

            const coffeeLabelText = coffeePct != null
                ? `${cups.toFixed(1)} cups • higher than about ${coffeePct}% of this group`
                : `${cups.toFixed(1)} cups`;
            document.getElementById("coffeeLabel").innerText = coffeeLabelText;

            // Sleep position + label
            const sleepPosYou = getPosition(sleepValues, sleep);
            const sleepPosAvg = getPosition(sleepValues, avgSleep);
            document.getElementById("sleepYouWrap").style.left = sleepPosYou + "%";
            document.getElementById("sleepAvgWrap").style.left = sleepPosAvg + "%";

            const sleepLabelText = sleepPct != null
                ? `${sleep.toFixed(1)} hours • higher than about ${sleepPct}% of this group`
                : `${sleep.toFixed(1)} hours`;
            document.getElementById("sleepLabel").innerText = sleepLabelText;

            // Stress: compare within similar coffee intake group (±1 cup)
            const similarCoffeeGroup = group.filter(d =>
                typeof d.Coffee_Intake === "number" &&
                !isNaN(d.Coffee_Intake) &&
                Math.abs(d.Coffee_Intake - cups) <= 1
            );
            const stressGroup = similarCoffeeGroup.length >= 30 ? similarCoffeeGroup : group;

            const stressValues = stressGroup
                .map(d => levelToScore(d.Stress_Level))
                .filter(v => typeof v === "number" && !isNaN(v));

            let stressLabel = "";
            let stressComparison = "";

            if (stressValues.length > 0) {
                const avgStress = stressValues.reduce((a, b) => a + b, 0) / stressValues.length;
                const stressPct = getPercentile(stressValues, stressScore);

                if (stressPct > 66) {
                    stressComparison = "higher than most people with a similar coffee intake";
                } else if (stressPct < 33) {
                    stressComparison = "lower than many people with a similar coffee intake";
                } else {
                    stressComparison = "similar to most people with a similar coffee intake";
                }

                stressLabel =
                    `You rated ${stressScore}/10 • your stress is ${stressComparison}.`;
            } else {
                stressLabel = `You rated ${stressScore}/10 • we could not find enough similar records to compare.`;
            }

            // Stress position + label
            const stressPos = stressScoreToPos(stressScore);
            document.getElementById("stressYouWrap").style.left = stressPos + "%";
            document.getElementById("stressLabel").innerText = stressLabel;

            // Tooltips
            if (coffeePct != null) {
                attachTooltip("coffeeYou", `${coffeePct}% of people drink less than or equal to you`);
            } else {
                attachTooltip("coffeeYou", `Your coffee intake: ${cups.toFixed(1)} cups/day`);
            }
            attachTooltip("coffeeAvg", `Group average: ${avgCoffee.toFixed(1)} cups/day`);

            if (sleepPct != null) {
                attachTooltip("sleepYou", `${sleepPct}% of people sleep less than or equal to you`);
            } else {
                attachTooltip("sleepYou", `Your sleep: ${sleep.toFixed(1)} hours`);
            }
            attachTooltip("sleepAvg", `Group average: ${avgSleep.toFixed(1)} hours`);

            attachTooltip("stressYou", `Your stress: ${stressScore}/10${stressComparison ? " • " + stressComparison : ""}`);

            // Reveal visualisation
            document.getElementById("loadingMessage").classList.add("hidden");
            document.getElementById("vizContainer").classList.remove("hidden");
        }
    </script>

    <!-- Footer -->
    <footer
    class="w-full py-10 px-8 md:px-20 lg:px-28 mt-20 font-calibri text-[#362822] bg-[#F8EBD8] text-small md:text-body">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 md:gap-10">
            <div>
                <h3 class="font-semibold mb-2">Design</h3>
                <p>Jasmine Bamba</p>
                <p>Sienna Wu</p>
            </div>
            <div>
                <h3 class="font-semibold mb-2">Developer</h3>
                <p>Elizabeth Liao</p>
                <p>Sienna Wu</p>
            </div>
            <div class="text-left md:text-right">
                <h3 class="font-semibold mb-2">IAT 355 (Fall 2025) | Final Project</h3>
                <p>© 2025 Caffeine Mugs</p>
            </div>
        </div>
    </footer>
</body>
</html>